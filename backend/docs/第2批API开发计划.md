# 第2批API开发计划 - 主要业务模块

**计划时间**: 2025-12-25
**预计完成**: 2-3天
**接口数量**: 15个

---

## 📋 开发清单

### 1. 房车租赁模块 (5个接口)

#### 1.1 获取车辆列表
- **接口**: `GET /api/v1/vehicles`
- **优先级**: P1 (高)
- **依赖**: 门店模块已完成
- **参数**: cityId, storeId, startDate, endDate, vehicleType
- **功能**: 根据条件筛选可租赁车辆

#### 1.2 获取车辆详情
- **接口**: `GET /api/v1/vehicles/:id`
- **优先级**: P1 (高)
- **依赖**: 无
- **功能**: 查看车辆详细信息、配置、价格

#### 1.3 检查车辆可用性
- **接口**: `POST /api/v1/vehicles/:id/check-availability`
- **优先级**: P2 (中)
- **依赖**: 订单模块
- **功能**: 检查指定时间段车辆是否可租

#### 1.4 获取车辆价格
- **接口**: `POST /api/v1/vehicles/:id/calculate-price`
- **优先级**: P1 (高)
- **依赖**: 无
- **功能**: 计算租赁总价(含优惠券)

#### 1.5 获取推荐车辆
- **接口**: `GET /api/v1/vehicles/recommended`
- **优先级**: P3 (低)
- **依赖**: 无
- **功能**: 基于用户偏好推荐车辆

---

### 2. 订单管理模块 (8个接口)

#### 2.1 创建订单
- **接口**: `POST /api/v1/orders`
- **优先级**: P1 (高)
- **依赖**: 车辆模块、用户认证
- **功能**: 创建租赁订单

#### 2.2 获取订单列表
- **接口**: `GET /api/v1/orders`
- **优先级**: P1 (高)
- **依赖**: 用户认证
- **功能**: 查看用户所有订单

#### 2.3 获取订单详情
- **接口**: `GET /api/v1/orders/:id`
- **优先级**: P1 (高)
- **依赖**: 用户认证
- **功能**: 查看订单详细信息

#### 2.4 取消订单
- **接口**: `POST /api/v1/orders/:id/cancel`
- **优先级**: P2 (中)
- **依赖**: 支付模块
- **功能**: 取消订单并退款

#### 2.5 确认取车
- **接口**: `POST /api/v1/orders/:id/pickup`
- **优先级**: P2 (中)
- **依赖**: 无
- **功能**: 门店确认取车

#### 2.6 确认还车
- **接口**: `POST /api/v1/orders/:id/return`
- **优先级**: P2 (中)
- **依赖**: 无
- **功能**: 门店确认还车

#### 2.7 订单评价
- **接口**: `POST /api/v1/orders/:id/review`
- **优先级**: P3 (低)
- **依赖**: 订单完成
- **功能**: 用户评价订单

#### 2.8 获取订单统计
- **接口**: `GET /api/v1/orders/statistics`
- **优先级**: P3 (低)
- **依赖**: 无
- **功能**: 用户订单统计数据

---

### 3. 支付模块 (2个接口)

#### 3.1 创建支付
- **接口**: `POST /api/v1/payments`
- **优先级**: P1 (高)
- **依赖**: 订单模块
- **功能**: 创建支付订单(微信支付)

#### 3.2 支付回调
- **接口**: `POST /api/v1/payments/callback`
- **优先级**: P1 (高)
- **依赖**: 微信支付
- **功能**: 处理支付结果通知

---

## 🗄️ 数据库表需求

### 需要创建的表:
1. **vehicles** - 车辆表
2. **vehicle_models** - 车型表
3. **orders** - 订单表
4. **payments** - 支付表
5. **reviews** - 评价表

---

## 📝 实施步骤

### 第1步: 数据库准备
- [ ] 创建vehicles相关表
- [ ] 创建orders表
- [ ] 创建payments表
- [ ] 插入测试数据

### 第2步: 实现车辆模块
- [ ] 创建VehicleDAO
- [ ] 实现车辆路由
- [ ] 测试车辆接口

### 第3步: 实现订单模块
- [ ] 创建OrderDAO
- [ ] 实现订单路由
- [ ] 测试订单接口

### 第4步: 实现支付模块
- [ ] 创建PaymentDAO
- [ ] 实现支付路由
- [ ] 集成微信支付(Mock)

### 第5步: 联调测试
- [ ] 小程序切换到真实API
- [ ] 测试完整租车流程
- [ ] 修复问题

---

**预计工作量**: 2-3天
**关键路径**: 车辆列表 → 订单创建 → 支付
