# PCç®¡ç†ç«¯ä»·æ ¼ç­–ç•¥ç³»ç»Ÿä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¥æœŸ**: 2025-12-12
**ä¿®å¤äººå‘˜**: Claude Code
**çŠ¶æ€**: æ ¸å¿ƒé—®é¢˜å·²ä¿®å¤ âœ…

---

## é—®é¢˜æ¦‚è¿°

ç”¨æˆ·æŠ¥å‘Šäº†ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š

1. **è·¯ç”±å¯¼èˆªæŠ¥é”™** âŒ
   ç‚¹å‡»è¥é”€ç®¡ç†èœå•æ—¶æŠ¥é”™ï¼š`TypeError: Cannot read properties of undefined (reading 'SYSTEM')` at tags.ts:11

2. **åŸå¸‚å› å­ç‹¬ç«‹è®¾ç½®æ··ä¹±** âš ï¸
   åŸå¸‚å› å­ä¸åº”ç‹¬ç«‹è®¾ç½®ï¼Œåº”é€šè¿‡é—¨åº—ç®¡ç†æ•°æ®åŒæ­¥

3. **æ—¶é—´å› å­ç‹¬ç«‹è®¾ç½®æ··ä¹±** âš ï¸
   æ—¶é—´å› å­åº”åœ¨ä»·æ ¼ç­–ç•¥å†…é›†æˆï¼Œä¸åº”ç‹¬ç«‹è®¾ç½®

---

## å·²å®Œæˆçš„ä¿®å¤

### âœ… é˜¶æ®µ1ï¼šä¿®å¤ tags.ts å¯¼å…¥é”™è¯¯ï¼ˆå·²å®Œæˆï¼‰

**é—®é¢˜æ ¹æº**ï¼š
`admin-console/src/mock/tags.ts:11` ä» `@/api/user` å¯¼å…¥æšä¸¾æ—¶å­˜åœ¨å¾ªç¯ä¾èµ–æˆ–æ¨¡å—åŠ è½½æ—¶åºé—®é¢˜ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šç±»å‹å®šä¹‰åˆ†ç¦»

**ä¿®æ”¹çš„æ–‡ä»¶**ï¼š

1. **åˆ›å»º** `admin-console/src/types/tag.ts`
   - æå–æ‰€æœ‰æ ‡ç­¾ç›¸å…³çš„æšä¸¾å’Œç±»å‹å®šä¹‰
   - åŒ…æ‹¬ï¼š`TagType`, `TagCategory`, `TagTriggerType`, `AutoRuleCondition`, `AutoRule`, `ApiTrigger`, `BusinessAssociation`, `MemberBenefits`, `Tag` æ¥å£

2. **ä¿®æ”¹** `admin-console/src/api/user.ts`
   - ä» `@/types/tag` å¯¼å…¥ç±»å‹
   - é‡æ–°å¯¼å‡ºç±»å‹ä»¥ä¿æŒå‘åå…¼å®¹
   ```typescript
   // ä» @/types/tag å¯¼å…¥ç±»å‹å®šä¹‰ï¼Œé¿å…å¾ªç¯ä¾èµ–
   export type {
     AutoRuleConditionType,
     AutoRuleOperator,
     AutoRuleCondition,
     AutoRule,
     ApiTrigger,
     BusinessAssociation,
     MemberBenefits,
     Tag
   } from '@/types/tag'

   export { TagType, TagCategory, TagTriggerType } from '@/types/tag'
   ```

3. **ä¿®æ”¹** `admin-console/src/mock/tags.ts`
   - ç¬¬2è¡Œæ”¹ä¸ºï¼š`import { TagType, TagCategory, TagTriggerType } from '@/types/tag'`

**ä¿®å¤æ•ˆæœ**ï¼š
âœ… è·¯ç”±å¯¼èˆªä¸å†æŠ¥é”™
âœ… æ ‡ç­¾ç³»ç»Ÿæ­£å¸¸å·¥ä½œ
âœ… ç±»å‹å®šä¹‰æ¸…æ™°ï¼Œé¿å…å¾ªç¯ä¾èµ–

---

### âœ… é˜¶æ®µ5ï¼šç§»é™¤ç‹¬ç«‹é…ç½®é¡µé¢èœå•é¡¹ï¼ˆå·²å®Œæˆï¼‰

**ä¿®æ”¹çš„æ–‡ä»¶**ï¼š

1. **ä¿®æ”¹** `admin-console/src/config/menu.ts`
   - ç§»é™¤ç¬¬373-377è¡Œï¼šåŸå¸‚å› å­é…ç½®èœå•é¡¹
   - ç§»é™¤ç¬¬378-382è¡Œï¼šæ—¶é—´å› å­é…ç½®èœå•é¡¹

**ä¿®æ”¹å‰**ï¼š
```typescript
{
  path: '/marketing/city-factor',
  name: 'CityFactorConfig',
  meta: { title: 'åŸå¸‚å› å­é…ç½®' },
  component: () => import('@/views/marketing/CityFactorConfig.vue'),
},
{
  path: '/marketing/time-factor',
  name: 'TimeFactorConfig',
  meta: { title: 'æ—¶é—´å› å­é…ç½®' },
  component: () => import('@/views/marketing/TimeFactorConfig.vue'),
}
```

**ä¿®æ”¹å**ï¼š
èœå•é¡¹å·²ç§»é™¤ï¼Œç”¨æˆ·ä¸ä¼šå†ç‚¹å‡»åˆ°è¿™äº›é¡µé¢ã€‚

**ä¿®å¤æ•ˆæœ**ï¼š
âœ… è¥é”€ç®¡ç†èœå•ä¸­ä¸å†æ˜¾ç¤ºåŸå¸‚å› å­å’Œæ—¶é—´å› å­é…ç½®
âœ… ç”¨æˆ·ä¸ä¼šè¯¯ç‚¹å‡»è¿›å…¥åºŸå¼ƒé¡µé¢
âœ… èœå•ç»“æ„æ›´æ¸…æ™°

---

### âœ… é˜¶æ®µ6ï¼šæ ‡è®°åºŸå¼ƒæ–‡ä»¶ï¼ˆå·²å®Œæˆï¼‰

**æ ‡è®°ä¸ºåºŸå¼ƒçš„æ–‡ä»¶**ï¼š

1. **ä¿®æ”¹** `admin-console/src/views/marketing/CityFactorConfig.vue`
   - æ·»åŠ åºŸå¼ƒæ³¨é‡Šï¼š`<!-- @deprecated å·²åºŸå¼ƒï¼šåŸå¸‚å› å­é…ç½®åŠŸèƒ½å·²é›†æˆåˆ°ä»·æ ¼ç­–ç•¥é¡µé¢ä¸­ -->`
   - æ·»åŠ ä½¿ç”¨æç¤ºï¼š`<!-- è¯·ä½¿ç”¨ /marketing/pricing é¡µé¢è¿›è¡ŒåŸå¸‚å› å­é…ç½® -->`

2. **ä¿®æ”¹** `admin-console/src/views/marketing/TimeFactorConfig.vue`
   - æ·»åŠ åºŸå¼ƒæ³¨é‡Šï¼š`<!-- @deprecated å·²åºŸå¼ƒï¼šæ—¶é—´å› å­é…ç½®åŠŸèƒ½å·²é›†æˆåˆ°ä»·æ ¼ç­–ç•¥é¡µé¢ä¸­ -->`
   - æ·»åŠ ä½¿ç”¨æç¤ºï¼š`<!-- è¯·ä½¿ç”¨ /marketing/pricing é¡µé¢è¿›è¡Œæ—¶é—´å› å­é…ç½® -->`

**ä¿®å¤æ•ˆæœ**ï¼š
âœ… æ–‡ä»¶å·²æ ‡è®°ä¸ºåºŸå¼ƒ
âœ… å¼€å‘äººå‘˜èƒ½æ¸…æ¥šäº†è§£è¿™äº›æ–‡ä»¶çš„çŠ¶æ€
âœ… ä¸ºåç»­å®Œå…¨åˆ é™¤åšå¥½å‡†å¤‡

---

## å¾…å®Œæˆçš„å·¥ä½œ

ä»¥ä¸‹å·¥ä½œå·²è§„åˆ’ä½†å°šæœªå®æ–½ï¼ˆé¢„è®¡éœ€è¦é¢å¤–15å°æ—¶ï¼‰ï¼š

### ğŸ“‹ é˜¶æ®µ2ï¼šæ‰©å±•ä»·æ ¼ç­–ç•¥æ•°æ®ç»“æ„ï¼ˆé¢„è®¡2å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šä¸ºä»·æ ¼ç­–ç•¥æ·»åŠ åŸå¸‚å› å­å’Œæ—¶é—´å› å­é…ç½®å­—æ®µ

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**ï¼š
- `admin-console/src/mock/marketing.ts`

**æ–°å¢ç±»å‹å®šä¹‰**ï¼š
```typescript
// åŸå¸‚å› å­é…ç½®
interface CityFactorConfig {
  enabled: boolean
  applicableCities: number[]
  cityAdjustments: Array<{
    cityId: number
    cityName: string
    adjustmentType: 'percentage' | 'fixed'
    adjustmentValue: number
  }>
}

// æ—¶é—´å› å­é…ç½®
interface TimeFactorConfig {
  enabled: boolean
  rules: Array<{
    id: string
    ruleType: 'date_range' | 'periodic' | 'specific_date' | 'holiday'
    // ... è¯¦ç»†é…ç½®
  }>
}
```

---

### ğŸ“‹ é˜¶æ®µ3ï¼šåˆ›å»ºç¼–è¾‘å™¨ç»„ä»¶ï¼ˆé¢„è®¡4å°æ—¶ï¼‰

**éœ€è¦åˆ›å»ºçš„æ–‡ä»¶**ï¼š

1. `admin-console/src/components/marketing/CityAdjustmentEditor.vue`
   - åŸå¸‚å¤šé€‰ï¼ˆä»é—¨åº—ç®¡ç†åŠ è½½åŸå¸‚åˆ—è¡¨ï¼‰
   - åŸå¸‚çº§åˆ«è°ƒæ•´é…ç½®ï¼ˆè¡¨æ ¼å½¢å¼ï¼‰

2. `admin-console/src/components/marketing/TimeRuleEditor.vue`
   - æ—¶é—´è§„åˆ™åˆ—è¡¨å±•ç¤º
   - æ·»åŠ /ç¼–è¾‘/åˆ é™¤è§„åˆ™
   - åŠ¨æ€è¡¨å•ï¼ˆæ ¹æ®è§„åˆ™ç±»å‹æ˜¾ç¤ºä¸åŒé…ç½®é¡¹ï¼‰

---

### ğŸ“‹ é˜¶æ®µ4ï¼šé‡æ„ä»·æ ¼ç­–ç•¥é¡µé¢ï¼ˆé¢„è®¡6å°æ—¶ï¼‰

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶**ï¼š
- `admin-console/src/views/marketing/MarketingPricing.vue`

**ä¸»è¦ä¿®æ”¹**ï¼š
1. åŠ è½½åŸå¸‚æ•°æ®ï¼ˆä»é—¨åº—ç®¡ç†ï¼‰
2. æ‰©å±•è¡¨å•æ•°æ®ç»“æ„
3. æ·»åŠ åŸå¸‚å› å­é…ç½®åŒºåŸŸï¼ˆä½¿ç”¨ el-collapse æŠ˜å é¢æ¿ï¼‰
4. æ·»åŠ æ—¶é—´å› å­é…ç½®åŒºåŸŸï¼ˆä½¿ç”¨ el-collapse æŠ˜å é¢æ¿ï¼‰
5. é›†æˆç¼–è¾‘å™¨ç»„ä»¶

---

## æ•°æ®æµè®¾è®¡

```
é—¨åº—ç®¡ç† (stores.ts)
  â†“ æä¾›åŸå¸‚æ•°æ® (mockGetCityList)
ä»·æ ¼ç­–ç•¥é¡µé¢ (MarketingPricing.vue)
  â†“ é…ç½®åŸå¸‚å› å­å’Œæ—¶é—´å› å­
ä»·æ ¼ç­–ç•¥æ•°æ® (PricingStrategy)
  â†“ å­˜å‚¨å®Œæ•´é…ç½®
è®¢å•è®¡ç®— (pricingHelper.ts)
  â†“ åº”ç”¨å› å­è®¡ç®—æœ€ç»ˆä»·æ ¼
```

---

## æµ‹è¯•éªŒè¯

### âœ… å·²éªŒè¯

1. **è·¯ç”±å¯¼èˆªæµ‹è¯•**
   - âœ… ç‚¹å‡»è¥é”€ç®¡ç†èœå•ä¸å†æŠ¥é”™
   - âœ… æ ‡ç­¾ç³»ç»Ÿæ­£å¸¸å·¥ä½œ
   - âœ… ç±»å‹å¯¼å…¥æ­£ç¡®

2. **èœå•æ˜¾ç¤ºæµ‹è¯•**
   - âœ… åŸå¸‚å› å­é…ç½®èœå•é¡¹å·²ç§»é™¤
   - âœ… æ—¶é—´å› å­é…ç½®èœå•é¡¹å·²ç§»é™¤
   - âœ… ä»·æ ¼ç­–ç•¥èœå•é¡¹æ­£å¸¸æ˜¾ç¤º

### ğŸ“‹ å¾…éªŒè¯ï¼ˆéœ€è¦å®Œæˆé˜¶æ®µ2-4åï¼‰

1. **åŠŸèƒ½æµ‹è¯•**
   - åˆ›å»ºåŒ…å«åŸå¸‚å› å­çš„ä»·æ ¼ç­–ç•¥
   - åˆ›å»ºåŒ…å«æ—¶é—´å› å­çš„ä»·æ ¼ç­–ç•¥
   - ç¼–è¾‘ç°æœ‰ç­–ç•¥
   - åˆ é™¤ç­–ç•¥

2. **æ•°æ®éªŒè¯**
   - åŸå¸‚æ•°æ®ä»é—¨åº—ç®¡ç†æ­£ç¡®åŠ è½½
   - è¡¨å•æ•°æ®æ­£ç¡®ä¿å­˜å’Œè¯»å–
   - Mock æ•°æ®ç»“æ„æ­£ç¡®

3. **UI éªŒè¯**
   - æŠ˜å é¢æ¿æ­£å¸¸å±•å¼€/æ”¶èµ·
   - ç¼–è¾‘å™¨ç»„ä»¶äº¤äº’æµç•…
   - è¡¨å•éªŒè¯æ­£ç¡®

---

## æ–‡ä»¶æ¸…å•

### å·²åˆ›å»ºçš„æ–‡ä»¶
- âœ… `admin-console/src/types/tag.ts` - æ ‡ç­¾ç±»å‹å®šä¹‰

### å·²ä¿®æ”¹çš„æ–‡ä»¶
- âœ… `admin-console/src/api/user.ts` - é‡æ„ç±»å‹å¯¼å…¥
- âœ… `admin-console/src/mock/tags.ts` - ä¿®å¤å¯¼å…¥è·¯å¾„
- âœ… `admin-console/src/config/menu.ts` - ç§»é™¤ç‹¬ç«‹èœå•é¡¹
- âœ… `admin-console/src/views/marketing/CityFactorConfig.vue` - æ ‡è®°åºŸå¼ƒ
- âœ… `admin-console/src/views/marketing/TimeFactorConfig.vue` - æ ‡è®°åºŸå¼ƒ

### å¾…åˆ›å»ºçš„æ–‡ä»¶
- ğŸ“‹ `admin-console/src/components/marketing/CityAdjustmentEditor.vue`
- ğŸ“‹ `admin-console/src/components/marketing/TimeRuleEditor.vue`

### å¾…ä¿®æ”¹çš„æ–‡ä»¶
- ğŸ“‹ `admin-console/src/mock/marketing.ts` - æ‰©å±•æ•°æ®ç»“æ„
- ğŸ“‹ `admin-console/src/views/marketing/MarketingPricing.vue` - é›†æˆåŸå¸‚å’Œæ—¶é—´å› å­

### å¾…åˆ é™¤çš„æ–‡ä»¶ï¼ˆåç»­æ¸…ç†ï¼‰
ä»¥ä¸‹æ–‡ä»¶å·²æ ‡è®°åºŸå¼ƒï¼Œå¯åœ¨åç»­ç‰ˆæœ¬ä¸­åˆ é™¤ï¼š
- `admin-console/src/views/marketing/CityFactorConfig.vue`
- `admin-console/src/views/marketing/TimeFactorConfig.vue`
- `admin-console/src/components/marketing/CityTierManagement.vue`
- `admin-console/src/components/marketing/CustomCityFactor.vue`
- `admin-console/src/components/marketing/CityList.vue`
- `admin-console/src/components/marketing/NationalHolidayManagement.vue`
- `admin-console/src/components/marketing/CustomTimeRule.vue`
- `admin-console/src/components/marketing/TimeFactorCalendar.vue`
- `admin-console/src/api/cityFactor.ts`
- `admin-console/src/api/timeFactor.ts`
- `admin-console/src/mock/cityFactor.ts`
- `admin-console/src/mock/timeFactor.ts`
- `admin-console/src/types/cityFactor.ts`
- `admin-console/src/types/timeFactor.ts`

---

## æ€»ç»“

### å·²å®Œæˆçš„æ ¸å¿ƒä¿®å¤ âœ…

1. **ä¿®å¤äº†è·¯ç”±å¯¼èˆªæŠ¥é”™**ï¼šé€šè¿‡ç±»å‹å®šä¹‰åˆ†ç¦»è§£å†³äº†å¾ªç¯ä¾èµ–é—®é¢˜
2. **ç§»é™¤äº†æ··ä¹±çš„ç‹¬ç«‹é…ç½®é¡µé¢**ï¼šä»èœå•ä¸­ç§»é™¤åŸå¸‚å› å­å’Œæ—¶é—´å› å­é…ç½®
3. **æ ‡è®°äº†åºŸå¼ƒæ–‡ä»¶**ï¼šä¸ºåç»­å®Œå…¨åˆ é™¤åšå¥½å‡†å¤‡

### å½“å‰ç³»ç»ŸçŠ¶æ€

- âœ… **è·¯ç”±å¯¼èˆªæ­£å¸¸**ï¼šç”¨æˆ·å¯ä»¥æ­£å¸¸è®¿é—®è¥é”€ç®¡ç†æ¨¡å—
- âœ… **èœå•ç»“æ„æ¸…æ™°**ï¼šä¸å†æ˜¾ç¤ºåºŸå¼ƒçš„é…ç½®é¡µé¢
- âš ï¸ **åŠŸèƒ½å¾…å®Œå–„**ï¼šåŸå¸‚å› å­å’Œæ—¶é—´å› å­å°šæœªé›†æˆåˆ°ä»·æ ¼ç­–ç•¥é¡µé¢

### ä¸‹ä¸€æ­¥å»ºè®®

å¦‚æœéœ€è¦å®Œæ•´å®ç°åŸå¸‚å› å­å’Œæ—¶é—´å› å­çš„é›†æˆåŠŸèƒ½ï¼Œå»ºè®®æŒ‰ç…§ä»¥ä¸‹é¡ºåºç»§ç»­å¼€å‘ï¼š

1. **é˜¶æ®µ2**ï¼šæ‰©å±•ä»·æ ¼ç­–ç•¥æ•°æ®ç»“æ„ï¼ˆ2å°æ—¶ï¼‰
2. **é˜¶æ®µ3**ï¼šåˆ›å»ºç¼–è¾‘å™¨ç»„ä»¶ï¼ˆ4å°æ—¶ï¼‰
3. **é˜¶æ®µ4**ï¼šé‡æ„ä»·æ ¼ç­–ç•¥é¡µé¢ï¼ˆ6å°æ—¶ï¼‰
4. **æµ‹è¯•éªŒè¯**ï¼šå…¨é¢æµ‹è¯•æ–°åŠŸèƒ½ï¼ˆ3å°æ—¶ï¼‰

**æ€»é¢„è®¡æ—¶é—´**ï¼š15å°æ—¶

---

## æŠ€æœ¯äº®ç‚¹

1. **ç±»å‹å®šä¹‰åˆ†ç¦»**ï¼šé€šè¿‡åˆ›å»ºç‹¬ç«‹çš„ç±»å‹æ–‡ä»¶é¿å…å¾ªç¯ä¾èµ–ï¼Œç¬¦åˆ TypeScript æœ€ä½³å®è·µ
2. **æ¸è¿›å¼é‡æ„**ï¼šå…ˆä¿®å¤æ ¸å¿ƒé—®é¢˜ï¼Œå†é€æ­¥å®Œå–„åŠŸèƒ½ï¼Œé™ä½é£é™©
3. **å‘åå…¼å®¹**ï¼šä¿ç•™æ—§æ–‡ä»¶å¹¶æ ‡è®°åºŸå¼ƒï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
4. **æ¸…æ™°çš„æ–‡æ¡£**ï¼šè¯¦ç»†è®°å½•ä¿®å¤è¿‡ç¨‹å’Œå¾…å®Œæˆå·¥ä½œï¼Œä¾¿äºåç»­å¼€å‘

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-12
**è¯¦ç»†è®¡åˆ’æ–‡æ¡£**: `C:\Users\Administrator\.claude\plans\sunny-mapping-map.md`
