# å¾®ä¿¡å°ç¨‹åºå®šä½åŠŸèƒ½å®Œæ•´å®ç°æŠ¥å‘Š

## ğŸ“‹ å®æ–½æ¦‚è¿°

**å®æ–½æ—¥æœŸ**: 2025-12-12
**å®æ–½äººå‘˜**: Claude Code
**ä»»åŠ¡æè¿°**: å®Œæ•´å®ç°å¾®ä¿¡å°ç¨‹åºç”¨æˆ·å®šä½åŠŸèƒ½ï¼ŒåŒ…æ‹¬æƒé™ç®¡ç†ã€é”™è¯¯å¤„ç†å’Œç”¨æˆ·å¼•å¯¼

---

## ğŸ¯ å®æ–½ç›®æ ‡

è§£å†³å°ç¨‹åºå®šä½å¤±è´¥é—®é¢˜ï¼Œå®ç°ç¬¦åˆå¾®ä¿¡å®˜æ–¹è§„èŒƒçš„å®Œæ•´å®šä½åŠŸèƒ½ï¼š
1. å®Œæ•´çš„æƒé™æ£€æŸ¥å’Œæˆæƒæµç¨‹
2. å‹å¥½çš„ç”¨æˆ·å¼•å¯¼å’Œé”™è¯¯æç¤º
3. å¥å£®çš„é”™è¯¯å¤„ç†æœºåˆ¶
4. è¶…æ—¶å’Œé‡è¯•æœºåˆ¶

---

## ğŸ” é—®é¢˜åˆ†æ

### åŸæœ‰ä»£ç é—®é¢˜

**æ–‡ä»¶**: `miniprogram/pages/index/index.vue:198-237`

```typescript
// âŒ é—®é¢˜ä»£ç 
const checkLocationPermission = () => {
	uni.getSetting({
		success(res) {
			if (!res.authSetting['scope.userLocation']) {
				authorizeLocation();
			} else {
				getLocation();
			}
		}
	});
};

const getLocation = () => {
	uni.getLocation({
		type: 'gcj02',
		success: function (res) {
			console.log('å½“å‰ä½ç½®ï¼š' + res.longitude + ',' + res.latitude);
		},
		fail: function () {
			console.log('è·å–ä½ç½®å¤±è´¥'); // âŒ é”™è¯¯å¤„ç†ä¸å®Œæ•´
		}
	});
};
```

**ä¸»è¦é—®é¢˜**:
1. âŒ ç¼ºå°‘ç”¨æˆ·æ‹’ç»æˆæƒåçš„å¼•å¯¼é€»è¾‘
2. âŒ é”™è¯¯å¤„ç†è¿‡äºç®€å•ï¼Œæ²¡æœ‰åŒºåˆ†é”™è¯¯ç±»å‹
3. âŒ æ²¡æœ‰è¶…æ—¶æœºåˆ¶
4. âŒ æ²¡æœ‰åŠ è½½æç¤º
5. âŒ æ²¡æœ‰å¤„ç†å®šä½æœåŠ¡ä¸å¯ç”¨çš„æƒ…å†µ

---

## âœ… å®æ–½æ–¹æ¡ˆ

### 1. å®Œæ•´çš„å®šä½å·¥å…·ç±»

**æ–‡ä»¶**: `miniprogram/utils/location.ts`

#### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

##### 1.1 ç±»å‹å®šä¹‰

```typescript
// å®šä½ç»“æœæ¥å£
export interface LocationResult {
	latitude: number;
	longitude: number;
	speed: number;
	accuracy: number;
	altitude?: number;
	verticalAccuracy?: number;
	horizontalAccuracy?: number;
}

// å®šä½é”™è¯¯ç±»å‹æšä¸¾
export enum LocationErrorType {
	PERMISSION_DENIED = 'PERMISSION_DENIED',
	PERMISSION_NOT_DETERMINED = 'PERMISSION_NOT_DETERMINED',
	LOCATION_UNAVAILABLE = 'LOCATION_UNAVAILABLE',
	TIMEOUT = 'TIMEOUT',
	UNKNOWN = 'UNKNOWN'
}

// å®šä½é”™è¯¯æ¥å£
export interface LocationError {
	type: LocationErrorType;
	message: string;
	code?: number;
}
```

##### 1.2 æƒé™æ£€æŸ¥

```typescript
/**
 * æ£€æŸ¥å®šä½æƒé™çŠ¶æ€
 * @returns Promise<'authorized' | 'denied' | 'not determined'>
 */
export function checkLocationPermission(): Promise<'authorized' | 'denied' | 'not determined'> {
	return new Promise((resolve) => {
		uni.getSetting({
			success(res) {
				const authSetting = res.authSetting['scope.userLocation'];
				if (authSetting === true) {
					resolve('authorized');
				} else if (authSetting === false) {
					resolve('denied');
				} else {
					resolve('not determined');
				}
			},
			fail() {
				resolve('not determined');
			}
		});
	});
}
```

##### 1.3 æƒé™è¯·æ±‚

```typescript
/**
 * è¯·æ±‚å®šä½æƒé™æˆæƒ
 * @returns Promise<boolean> æ˜¯å¦æˆæƒæˆåŠŸ
 */
export function requestLocationPermission(): Promise<boolean> {
	return new Promise((resolve) => {
		uni.authorize({
			scope: 'scope.userLocation',
			success() {
				console.log('[å®šä½] ç”¨æˆ·æˆæƒå®šä½æˆåŠŸ');
				resolve(true);
			},
			fail(err) {
				console.log('[å®šä½] ç”¨æˆ·æ‹’ç»æˆæƒå®šä½', err);
				resolve(false);
			}
		});
	});
}
```

##### 1.4 å¼•å¯¼ç”¨æˆ·è®¾ç½®

```typescript
/**
 * å¼•å¯¼ç”¨æˆ·æ‰“å¼€è®¾ç½®é¡µé¢æˆæƒå®šä½
 */
export function guideToSettingPage(): Promise<boolean> {
	return new Promise((resolve) => {
		uni.showModal({
			title: 'éœ€è¦å®šä½æƒé™',
			content: 'ä¸ºäº†ç»™æ‚¨æä¾›æ›´å¥½çš„æœåŠ¡ï¼Œéœ€è¦è·å–æ‚¨çš„ä½ç½®ä¿¡æ¯ã€‚è¯·åœ¨è®¾ç½®ä¸­å¼€å¯å®šä½æƒé™ã€‚',
			confirmText: 'å»è®¾ç½®',
			cancelText: 'å–æ¶ˆ',
			success(res) {
				if (res.confirm) {
					uni.openSetting({
						success(settingRes) {
							const authSetting = settingRes.authSetting['scope.userLocation'];
							console.log('[å®šä½] ç”¨æˆ·è®¾ç½®é¡µé¢è¿”å›ï¼ŒæˆæƒçŠ¶æ€:', authSetting);
							resolve(authSetting === true);
						},
						fail() {
							resolve(false);
						}
					});
				} else {
					resolve(false);
				}
			},
			fail() {
				resolve(false);
			}
		});
	});
}
```

##### 1.5 è·å–ç”¨æˆ·ä½ç½®ï¼ˆæ ¸å¿ƒå‡½æ•°ï¼‰

```typescript
/**
 * è·å–ç”¨æˆ·ä½ç½®ï¼ˆå®Œæ•´ç‰ˆæœ¬ï¼‰
 * @param options é…ç½®é€‰é¡¹
 * @returns Promise<LocationResult>
 */
export async function getUserLocation(options?: {
	type?: 'wgs84' | 'gcj02';
	altitude?: boolean;
	highAccuracyExpireTime?: number;
	timeout?: number;
	showLoading?: boolean;
}): Promise<LocationResult> {
	const {
		type = 'gcj02',
		altitude = false,
		highAccuracyExpireTime = 3000,
		timeout = 10000,
		showLoading = false
	} = options || {};

	// 1. æ£€æŸ¥æƒé™çŠ¶æ€
	const permissionStatus = await checkLocationPermission();
	console.log('[å®šä½] æƒé™çŠ¶æ€:', permissionStatus);

	// 2. å¦‚æœæœªæˆæƒï¼Œå°è¯•è¯·æ±‚æˆæƒ
	if (permissionStatus === 'not determined') {
		const authorized = await requestLocationPermission();
		if (!authorized) {
			throw {
				type: LocationErrorType.PERMISSION_DENIED,
				message: 'ç”¨æˆ·æ‹’ç»æˆæƒå®šä½'
			} as LocationError;
		}
	}

	// 3. å¦‚æœå·²æ‹’ç»ï¼Œå¼•å¯¼ç”¨æˆ·å»è®¾ç½®
	if (permissionStatus === 'denied') {
		const authorized = await guideToSettingPage();
		if (!authorized) {
			throw {
				type: LocationErrorType.PERMISSION_DENIED,
				message: 'ç”¨æˆ·æœªåœ¨è®¾ç½®ä¸­å¼€å¯å®šä½æƒé™'
			} as LocationError;
		}
	}

	// 4. æ˜¾ç¤ºåŠ è½½æç¤º
	if (showLoading) {
		uni.showLoading({
			title: 'å®šä½ä¸­...',
			mask: true
		});
	}

	// 5. è·å–å®šä½ï¼ˆå¸¦è¶…æ—¶æœºåˆ¶ï¼‰
	return new Promise((resolve, reject) => {
		const timer = setTimeout(() => {
			if (showLoading) {
				uni.hideLoading();
			}
			reject({
				type: LocationErrorType.TIMEOUT,
				message: 'å®šä½è¶…æ—¶'
			} as LocationError);
		}, timeout);

		uni.getLocation({
			type,
			altitude,
			highAccuracyExpireTime,
			isHighAccuracy: true,
			success(res) {
				clearTimeout(timer);
				if (showLoading) {
					uni.hideLoading();
				}

				console.log('[å®šä½] è·å–ä½ç½®æˆåŠŸ:', res);

				resolve({
					latitude: res.latitude,
					longitude: res.longitude,
					speed: res.speed,
					accuracy: res.accuracy,
					altitude: res.altitude,
					verticalAccuracy: res.verticalAccuracy,
					horizontalAccuracy: res.horizontalAccuracy
				});
			},
			fail(err) {
				clearTimeout(timer);
				if (showLoading) {
					uni.hideLoading();
				}

				console.error('[å®šä½] è·å–ä½ç½®å¤±è´¥:', err);

				// è§£æé”™è¯¯ç±»å‹
				let errorType = LocationErrorType.UNKNOWN;
				let errorMessage = 'å®šä½å¤±è´¥';

				if (err.errMsg) {
					if (err.errMsg.includes('auth deny') || err.errMsg.includes('authorize')) {
						errorType = LocationErrorType.PERMISSION_DENIED;
						errorMessage = 'å®šä½æƒé™è¢«æ‹’ç»';
					} else if (err.errMsg.includes('timeout')) {
						errorType = LocationErrorType.TIMEOUT;
						errorMessage = 'å®šä½è¶…æ—¶';
					} else if (err.errMsg.includes('fail')) {
						errorType = LocationErrorType.LOCATION_UNAVAILABLE;
						errorMessage = 'å®šä½æœåŠ¡ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥æ‰‹æœºå®šä½è®¾ç½®';
					}
				}

				reject({
					type: errorType,
					message: errorMessage,
					code: err.errno
				} as LocationError);
			}
		});
	});
}
```

### 2. é¦–é¡µé›†æˆå®šä½åŠŸèƒ½

**æ–‡ä»¶**: `miniprogram/pages/index/index.vue`

#### 2.1 å¯¼å…¥å®šä½å·¥å…·

```typescript
import { getUserLocation, reverseGeocode, type LocationResult, type LocationError, LocationErrorType } from '@/utils/location';
```

#### 2.2 å®šä¹‰çŠ¶æ€

```typescript
// ç”¨æˆ·ä½ç½®ä¿¡æ¯
const userLocation = ref<LocationResult | null>(null);
const userCity = ref<string>('');
```

#### 2.3 åˆå§‹åŒ–å®šä½

```typescript
/**
 * åˆå§‹åŒ–å®šä½
 */
const initLocation = async () => {
	try {
		console.log('[é¦–é¡µ] å¼€å§‹è·å–ç”¨æˆ·ä½ç½®');

		// è·å–ç”¨æˆ·ä½ç½®
		const location = await getUserLocation({
			type: 'gcj02',
			showLoading: true,
			timeout: 10000
		});

		userLocation.value = location;
		console.log('[é¦–é¡µ] è·å–ä½ç½®æˆåŠŸ:', location);

		// é€†åœ°ç†ç¼–ç è·å–åŸå¸‚
		const city = await reverseGeocode(location.latitude, location.longitude);
		userCity.value = city;
		console.log('[é¦–é¡µ] å½“å‰åŸå¸‚:', city);

		// æ˜¾ç¤ºæˆåŠŸæç¤º
		uni.showToast({
			title: `å®šä½æˆåŠŸï¼š${city}`,
			icon: 'success',
			duration: 2000
		});

	} catch (error) {
		const locationError = error as LocationError;
		console.error('[é¦–é¡µ] è·å–ä½ç½®å¤±è´¥:', locationError);

		// æ ¹æ®é”™è¯¯ç±»å‹æ˜¾ç¤ºä¸åŒæç¤º
		let errorMessage = 'å®šä½å¤±è´¥';

		switch (locationError.type) {
			case LocationErrorType.PERMISSION_DENIED:
				errorMessage = 'å®šä½æƒé™è¢«æ‹’ç»ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½æ— æ³•ä½¿ç”¨';
				break;
			case LocationErrorType.TIMEOUT:
				errorMessage = 'å®šä½è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
				break;
			case LocationErrorType.LOCATION_UNAVAILABLE:
				errorMessage = 'å®šä½æœåŠ¡ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥æ‰‹æœºå®šä½è®¾ç½®';
				break;
			default:
				errorMessage = locationError.message || 'å®šä½å¤±è´¥';
		}

		uni.showToast({
			title: errorMessage,
			icon: 'none',
			duration: 3000
		});

		// ä½¿ç”¨é»˜è®¤åŸå¸‚
		userCity.value = 'åŒ—äº¬';
		console.log('[é¦–é¡µ] ä½¿ç”¨é»˜è®¤åŸå¸‚:', userCity.value);
	}
};
```

#### 2.4 é¡µé¢åŠ è½½æ—¶è°ƒç”¨

```typescript
onMounted(() => {
	const systemInfo = uni.getSystemInfoSync();
	statusBarHeight.value = systemInfo.statusBarHeight || 0;

	// åˆå§‹åŒ–å®šä½
	initLocation();
});
```

### 3. æƒé™é…ç½®

**æ–‡ä»¶**: `miniprogram/manifest.json`

```json
{
	"mp-weixin": {
		"appid": "wx545d8668053b84a8",
		"setting": {
			"urlCheck": false
		},
		"usingComponents": true,
		"mergeVirtualHostAttributes": true,
		"lazyCodeLoading": "requiredComponents",
		"permission": {
			"scope.userLocation": {
				"desc": "ä»…ç”¨äºä¸ºæ‚¨æä¾›é™„è¿‘é—¨åº—æœåŠ¡"
			}
		}
	}
}
```

---

## ğŸ¨ ç”¨æˆ·ä½“éªŒæµç¨‹

### åœºæ™¯ 1: é¦–æ¬¡ä½¿ç”¨ï¼ˆæœªæˆæƒï¼‰

```
1. ç”¨æˆ·æ‰“å¼€å°ç¨‹åºé¦–é¡µ
   â†“
2. ç³»ç»Ÿæ£€æµ‹åˆ°æœªæˆæƒå®šä½
   â†“
3. å¼¹å‡ºå¾®ä¿¡å®˜æ–¹æˆæƒå¼¹çª—
   â”œâ”€ ç”¨æˆ·ç‚¹å‡»"å…è®¸" â†’ è·å–å®šä½ â†’ æ˜¾ç¤º"å®šä½æˆåŠŸï¼šåŒ—äº¬"
   â””â”€ ç”¨æˆ·ç‚¹å‡»"æ‹’ç»" â†’ æ˜¾ç¤º"å®šä½æƒé™è¢«æ‹’ç»ï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½æ— æ³•ä½¿ç”¨" â†’ ä½¿ç”¨é»˜è®¤åŸå¸‚
```

### åœºæ™¯ 2: å·²æ‹’ç»æˆæƒ

```
1. ç”¨æˆ·æ‰“å¼€å°ç¨‹åºé¦–é¡µ
   â†“
2. ç³»ç»Ÿæ£€æµ‹åˆ°å·²æ‹’ç»æˆæƒ
   â†“
3. å¼¹å‡ºè‡ªå®šä¹‰å¼•å¯¼å¼¹çª—
   "éœ€è¦å®šä½æƒé™
    ä¸ºäº†ç»™æ‚¨æä¾›æ›´å¥½çš„æœåŠ¡ï¼Œéœ€è¦è·å–æ‚¨çš„ä½ç½®ä¿¡æ¯ã€‚
    è¯·åœ¨è®¾ç½®ä¸­å¼€å¯å®šä½æƒé™ã€‚"
   â”œâ”€ ç”¨æˆ·ç‚¹å‡»"å»è®¾ç½®" â†’ è·³è½¬åˆ°è®¾ç½®é¡µé¢ â†’ ç”¨æˆ·å¼€å¯æƒé™ â†’ è·å–å®šä½
   â””â”€ ç”¨æˆ·ç‚¹å‡»"å–æ¶ˆ" â†’ ä½¿ç”¨é»˜è®¤åŸå¸‚
```

### åœºæ™¯ 3: å®šä½è¶…æ—¶

```
1. ç”¨æˆ·æ‰“å¼€å°ç¨‹åºé¦–é¡µ
   â†“
2. æ˜¾ç¤º"å®šä½ä¸­..."åŠ è½½æç¤º
   â†“
3. 10ç§’åä»æœªè·å–åˆ°ä½ç½®
   â†“
4. æ˜¾ç¤º"å®šä½è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"
   â†“
5. ä½¿ç”¨é»˜è®¤åŸå¸‚
```

### åœºæ™¯ 4: å®šä½æœåŠ¡ä¸å¯ç”¨

```
1. ç”¨æˆ·æ‰“å¼€å°ç¨‹åºé¦–é¡µ
   â†“
2. ç³»ç»Ÿæ£€æµ‹åˆ°æ‰‹æœºå®šä½æœåŠ¡æœªå¼€å¯
   â†“
3. æ˜¾ç¤º"å®šä½æœåŠ¡ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥æ‰‹æœºå®šä½è®¾ç½®"
   â†“
4. ä½¿ç”¨é»˜è®¤åŸå¸‚
```

---

## ğŸ“Š æŠ€æœ¯ç‰¹æ€§

### 1. å®Œæ•´çš„æƒé™ç®¡ç†

- âœ… ä¸‰ç§æƒé™çŠ¶æ€æ£€æµ‹ï¼š`authorized`ã€`denied`ã€`not determined`
- âœ… è‡ªåŠ¨è¯·æ±‚æˆæƒæµç¨‹
- âœ… å¼•å¯¼ç”¨æˆ·åˆ°è®¾ç½®é¡µé¢
- âœ… å‹å¥½çš„ç”¨æˆ·æç¤º

### 2. å¥å£®çš„é”™è¯¯å¤„ç†

- âœ… é”™è¯¯ç±»å‹æšä¸¾ï¼š`PERMISSION_DENIED`ã€`TIMEOUT`ã€`LOCATION_UNAVAILABLE`ã€`UNKNOWN`
- âœ… è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- âœ… é”™è¯¯ç è®°å½•
- âœ… é™çº§ç­–ç•¥ï¼ˆä½¿ç”¨é»˜è®¤åŸå¸‚ï¼‰

### 3. è¶…æ—¶æœºåˆ¶

- âœ… å¯é…ç½®è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ 10 ç§’ï¼‰
- âœ… è‡ªåŠ¨æ¸…ç†å®šæ—¶å™¨
- âœ… è¶…æ—¶åæ˜¾ç¤ºå‹å¥½æç¤º

### 4. åŠ è½½æç¤º

- âœ… å¯é€‰çš„åŠ è½½æç¤º
- âœ… è‡ªåŠ¨éšè—åŠ è½½æç¤º
- âœ… é˜²æ­¢ç”¨æˆ·é‡å¤æ“ä½œ

### 5. é«˜ç²¾åº¦å®šä½

- âœ… å¯ç”¨ `isHighAccuracy: true`
- âœ… å¯é…ç½®é«˜ç²¾åº¦è¿‡æœŸæ—¶é—´
- âœ… è¿”å›å®Œæ•´çš„å®šä½ä¿¡æ¯ï¼ˆç»çº¬åº¦ã€é€Ÿåº¦ã€ç²¾åº¦ç­‰ï¼‰

---

## ğŸ”§ é…ç½®é€‰é¡¹

### getUserLocation å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| type | 'wgs84' \| 'gcj02' | 'gcj02' | åæ ‡ç³»ç±»å‹ |
| altitude | boolean | false | æ˜¯å¦è¿”å›é«˜åº¦ä¿¡æ¯ |
| highAccuracyExpireTime | number | 3000 | é«˜ç²¾åº¦å®šä½è¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |
| timeout | number | 10000 | å®šä½è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |
| showLoading | boolean | false | æ˜¯å¦æ˜¾ç¤ºåŠ è½½æç¤º |

### ä½¿ç”¨ç¤ºä¾‹

```typescript
// åŸºç¡€ä½¿ç”¨
const location = await getUserLocation();

// å®Œæ•´é…ç½®
const location = await getUserLocation({
	type: 'gcj02',
	altitude: true,
	highAccuracyExpireTime: 5000,
	timeout: 15000,
	showLoading: true
});
```

---

## ğŸ“ æ—¥å¿—è¾“å‡º

### æˆåŠŸæ—¥å¿—

```
[å®šä½] æƒé™çŠ¶æ€: authorized
[å®šä½] è·å–ä½ç½®æˆåŠŸ: {latitude: 39.9042, longitude: 116.4074, ...}
[é¦–é¡µ] è·å–ä½ç½®æˆåŠŸ: {latitude: 39.9042, longitude: 116.4074, ...}
[é¦–é¡µ] å½“å‰åŸå¸‚: åŒ—äº¬
```

### å¤±è´¥æ—¥å¿—

```
[å®šä½] æƒé™çŠ¶æ€: denied
[å®šä½] ç”¨æˆ·è®¾ç½®é¡µé¢è¿”å›ï¼ŒæˆæƒçŠ¶æ€: false
[é¦–é¡µ] è·å–ä½ç½®å¤±è´¥: {type: 'PERMISSION_DENIED', message: 'ç”¨æˆ·æœªåœ¨è®¾ç½®ä¸­å¼€å¯å®šä½æƒé™'}
[é¦–é¡µ] ä½¿ç”¨é»˜è®¤åŸå¸‚: åŒ—äº¬
```

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. æƒé™æµ‹è¯•

- [ ] é¦–æ¬¡ä½¿ç”¨ï¼Œç‚¹å‡»"å…è®¸"
- [ ] é¦–æ¬¡ä½¿ç”¨ï¼Œç‚¹å‡»"æ‹’ç»"
- [ ] å·²æ‹’ç»æˆæƒï¼Œç‚¹å‡»"å»è®¾ç½®"å¹¶å¼€å¯
- [ ] å·²æ‹’ç»æˆæƒï¼Œç‚¹å‡»"å–æ¶ˆ"

### 2. å®šä½æµ‹è¯•

- [ ] æ­£å¸¸å®šä½æˆåŠŸ
- [ ] å®šä½è¶…æ—¶ï¼ˆå…³é—­ç½‘ç»œï¼‰
- [ ] å®šä½æœåŠ¡ä¸å¯ç”¨ï¼ˆå…³é—­æ‰‹æœºå®šä½ï¼‰
- [ ] å®šä½ç²¾åº¦æµ‹è¯•

### 3. ç”¨æˆ·ä½“éªŒæµ‹è¯•

- [ ] åŠ è½½æç¤ºæ˜¾ç¤ºæ­£å¸¸
- [ ] é”™è¯¯æç¤ºæ–‡æ¡ˆå‹å¥½
- [ ] é™çº§ç­–ç•¥ç”Ÿæ•ˆ
- [ ] æ—¥å¿—è¾“å‡ºå®Œæ•´

---

## ğŸ“¦ æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶

1. **miniprogram/utils/location.ts** - å®Œæ•´é‡å†™å®šä½å·¥å…·ç±»
2. **miniprogram/pages/index/index.vue** - æ›´æ–°é¦–é¡µå®šä½é€»è¾‘

### é…ç½®æ–‡ä»¶

1. **miniprogram/manifest.json** - å·²é…ç½®å®šä½æƒé™è¯´æ˜

---

## ğŸ¯ å®æ–½ç»“æœ

### âœ… å·²å®Œæˆ

1. âœ… å®Œæ•´çš„å®šä½å·¥å…·ç±»å®ç°
2. âœ… æƒé™æ£€æŸ¥å’Œæˆæƒæµç¨‹
3. âœ… ç”¨æˆ·å¼•å¯¼å’Œé”™è¯¯å¤„ç†
4. âœ… è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
5. âœ… é¦–é¡µé›†æˆå®šä½åŠŸèƒ½
6. âœ… å‹å¥½çš„ç”¨æˆ·æç¤º

### ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

1. **çœŸå®é€†åœ°ç†ç¼–ç **: å½“å‰ä½¿ç”¨åæ ‡èŒƒå›´åˆ¤æ–­åŸå¸‚ï¼Œåç»­å¯æ¥å…¥è…¾è®¯åœ°å›¾ API è·å–è¯¦ç»†åœ°å€
2. **å®šä½ç¼“å­˜**: å¯ä»¥ç¼“å­˜ç”¨æˆ·ä½ç½®ï¼Œé¿å…é¢‘ç¹å®šä½
3. **å®šä½ç²¾åº¦ä¼˜åŒ–**: æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´å®šä½ç²¾åº¦å’Œè¶…æ—¶æ—¶é—´
4. **åŸ‹ç‚¹ç»Ÿè®¡**: ç»Ÿè®¡å®šä½æˆåŠŸç‡ã€å¤±è´¥åŸå› ç­‰æ•°æ®

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

1. [å¾®ä¿¡å°ç¨‹åº - wx.getLocation](https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.getLocation.html)
2. [å¾®ä¿¡å°ç¨‹åº - wx.getSetting](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/setting/wx.getSetting.html)
3. [å¾®ä¿¡å°ç¨‹åº - wx.authorize](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/authorize/wx.authorize.html)
4. [å¾®ä¿¡å°ç¨‹åº - wx.openSetting](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/setting/wx.openSetting.html)
5. [uni-app - ä½ç½® API](https://uniapp.dcloud.net.cn/api/location/location.html)

---

## ğŸ‘¨â€ğŸ’» å¼€å‘è€…è¯´æ˜

### å¦‚ä½•ä½¿ç”¨å®šä½å·¥å…·ç±»

```typescript
import { getUserLocation, LocationErrorType } from '@/utils/location';

// åœ¨ä»»ä½•é¡µé¢æˆ–ç»„ä»¶ä¸­ä½¿ç”¨
async function getMyLocation() {
	try {
		const location = await getUserLocation({
			showLoading: true,
			timeout: 10000
		});

		console.log('çº¬åº¦:', location.latitude);
		console.log('ç»åº¦:', location.longitude);
		console.log('ç²¾åº¦:', location.accuracy);

	} catch (error) {
		const locationError = error as LocationError;

		if (locationError.type === LocationErrorType.PERMISSION_DENIED) {
			// å¤„ç†æƒé™è¢«æ‹’ç»
		} else if (locationError.type === LocationErrorType.TIMEOUT) {
			// å¤„ç†è¶…æ—¶
		}
	}
}
```

### å¦‚ä½•æ‰©å±•åŠŸèƒ½

1. **æ·»åŠ æ–°çš„é”™è¯¯ç±»å‹**: åœ¨ `LocationErrorType` æšä¸¾ä¸­æ·»åŠ 
2. **ä¿®æ”¹è¶…æ—¶æ—¶é—´**: è°ƒæ•´ `getUserLocation` çš„ `timeout` å‚æ•°
3. **è‡ªå®šä¹‰æç¤ºæ–‡æ¡ˆ**: ä¿®æ”¹ `guideToSettingPage` ä¸­çš„å¼¹çª—æ–‡æ¡ˆ
4. **æ·»åŠ å®šä½ç¼“å­˜**: åœ¨ `getUserLocation` ä¸­æ·»åŠ ç¼“å­˜é€»è¾‘

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-12
**ç‰ˆæœ¬**: v1.0.0
**çŠ¶æ€**: âœ… å®æ–½å®Œæˆ
